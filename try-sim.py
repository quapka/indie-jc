#! /usr/bin/env nix-shell
#! nix-shell -i python3 -p python312Packages.pyscard

import smartcard

from smartcard.System import readers


def main():
    r = readers()
    print(smartcard)
    print(r)

    connection = r[0].createConnection()
    connection.connect()

    DERIVE_SALT_APDU = bytes.fromhex(
        "000300000001E465794A68624763694F694A46557A49314E694973496E523563434936496B705856434973496D74705A434936496D5634595731776247556966512E65794A7063334D694F694A6F64485277637A6F764C324631644768736157497562334A6E496977695958566B496A7062496E70725447396E615734695853776961574630496A6F784E7A51314E7A637A4E5449334C434A6C654841694F6A45334E4455334E7A63784D6A6373496D46316447686664476C745A5349364D5463304E5463334D7A55794E697769626D3975593255694F6949794E5456695A6D46684E7A6B345A574D304D7A51784E6A6C6C4D6D4E694F5752694D7A4E6A4E32566B4E574578595445324D6A45354E6D51345A5449774E7A55784D6A45324D474D334E54673159544A694D544D3349697769595852666147467A61434936496B5535526E564C58327054617A4A3056474648574646524D453136574545694C434A7A645749694F6949784D694973496D3568625755694F694A4761584A7A64473568625755675447467A644735686257556966512E6D76324A6D4968326C75305563706876316E36476F6E364A3241776F4D3745776B446A61527149745F464A3353594F57515367557A7165726E596F713734396332736D394870414561477A315F386F685631396A3877"
    )
    print(DERIVE_SALT_APDU)
    print(len(DERIVE_SALT_APDU))

    DERIVE_SALT_APDU = [x for x in DERIVE_SALT_APDU]
    print(DERIVE_SALT_APDU)

    data, sw1, sw2 = connection.transmit([0x00, 0xA4, 0x04, 0x00])
    print("%x %x" % (sw1, sw2))
    print(bytes(data).hex())
    data, sw1, sw2 = connection.transmit(DERIVE_SALT_APDU)
    print("%x %x" % (sw1, sw2))
    print(bytes(data).hex())


if __name__ == "__main__":
    main()
